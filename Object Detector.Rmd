---
title: "Object Detector"
autor: "Marija Stanojcic"
output: html_notebook
---

```{r}
# Load libraries
library(jpeg)
library(httr)
library(dplyr)
```


```{r}
# Visualize the image
jj <- readJPEG("baby-bear.jpeg",native=TRUE)
plot(0:1,0:1,type="n",ann=FALSE,axes=FALSE)
rasterImage(jj,0,0,1,1)
```


```{r}
model_endpoint_object_detector <- paste0('http://max-object-detector.max.us-south.containers.appdomain.cloud/', 'model/predict')

image <- upload_file("baby-bear.jpeg")
# POST
response_object <- httr::POST(model_endpoint_object_detector,
                       body = list(
                         image = upload_file("baby-bear.jpeg",
                                             type = "image/jpeg")
                       ), encode = c("multipart")
) %>% content()

# response_object
```



```{r}
# not working
# do.call(what = rbind.data.frame, args = response_object$predictions)
```

```{r}
my_data <- data.frame(LabelID = character(), label = character(), probability = numeric(), stringsAsFactors = FALSE)
det_box <- data.frame()
row <- character()
det_box_row <- vector()

for (i in 1:length(response_object$predictions)){
  row <- cbind(response_object$predictions[[i]]$label_id, response_object$predictions[[i]]$label, response_object$predictions[[i]]$probability)
  my_data <- rbind(row, my_data) # predictions
  det_box_row <- rbind(t(matrix(unlist(response_object$predictions[[i]]$detection_box), nrow=4)))
  det_box <- rbind(det_box_row, det_box) # coordinates 
}

colnames(my_data) <- c("LabelID", "Label", "Probability")
my_data %>% arrange(desc(Probability)) -> my_data

my_data

```

```{r}
n <- nrow(my_data)
paste0(n, " objects indentified.")

```

```{r}
for ( i in 1:n){
  cat(paste0("The object ", i, " is ", my_data$Label[i],".", "\n"))

}

```

Getting the cordinates for the boxes.

```{r}
colnames(det_box) <- c("ymin", "xmin", "ymax", "xmax")
det_box
```










